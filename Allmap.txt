-- Services
local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer
local LocalPlayer = game:GetService("Players").LocalPlayer

local WindUI = loadstring(game:HttpGet(
    "https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"
))()

local Window = WindUI:CreateWindow({
    Title = "ERROR HUB [ ALL Map ]",
    Icon = "rbxassetid://108455308252343", 
    Author = "",
    Folder = "ERROR HUB [ ALL Map ]",
    Size = UDim2.fromOffset(450, 330),
    Theme = "Violet", 
    Transparent = true,
    Resizable = true,
})

Window:EditOpenButton({ Enabled = false }) 

local ScreenGui = Instance.new("ScreenGui")
local ToggleBtn = Instance.new("ImageButton")
local UICorner = Instance.new("UICorner") 

ScreenGui.Name = "ERROR HUB"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = CoreGui

ToggleBtn.Size = UDim2.new(0, 50, 0, 50)
ToggleBtn.Position = UDim2.new(0, 20, 0.5, -25)
ToggleBtn.BackgroundColor3 = Color3.fromRGB(138, 43, 226)
ToggleBtn.BackgroundTransparency = 0
ToggleBtn.Image = "rbxassetid://108455308252343"
ToggleBtn.Active = true
ToggleBtn.Draggable = true
ToggleBtn.Parent = ScreenGui

UICorner.CornerRadius = UDim.new(0, 12) 
UICorner.Parent = ToggleBtn

local opened = true

local function toggle()
    opened = not opened
    if Window.UI then
        Window.UI.Enabled = opened
    else
        Window:Toggle()
    end
end

ToggleBtn.MouseButton1Click:Connect(function()
    ToggleBtn:TweenSize(
        UDim2.new(0, 56, 0, 56),
        Enum.EasingDirection.Out,
        Enum.EasingStyle.Quad,
        0.12,
        true,
        function()
            ToggleBtn:TweenSize(
                UDim2.new(0, 50, 0, 50),
                Enum.EasingDirection.Out,
                Enum.EasingStyle.Quad,
                0.12,
                true
            )
        end
    )
    toggle()
end)

UserInputService.InputBegan:Connect(function(input, gp)
    if gp then return end
    if input.KeyCode == Enum.KeyCode.T then
        toggle()
    end
end)



-- ตัวแปร
local enabled = false
local speedLevel = 1
local speedValue = 60
local loopConnection = nil

local jumpEnabled = false
local jumpPowerValue = 50
local jumpLoop = nil

local frontNoclip = false
local radius = 6
local trackedParts = {}

local ESPEnabled = false
local ESPHealthEnabled = false
-- ====
-- ฟังชั่นต่างๆ
-- ======

local function updateSpeed()
    speedValue = speedLevel * 60
end
updateSpeed()

local function toggleMovement(on)
    enabled = on

    if loopConnection then
        loopConnection:Disconnect()
        loopConnection = nil
    end

    if on then
        loopConnection = RunService.Heartbeat:Connect(function(dt)
            local char = player.Character
            local root = char and char:FindFirstChild("HumanoidRootPart")
            local hum = char and char:FindFirstChildOfClass("Humanoid")
            if not (char and root and hum) then return end

            local moveDir = hum.MoveDirection
            if moveDir.Magnitude > 0 then
                root.CFrame = root.CFrame + moveDir * (speedValue * dt)
            end
        end)
    end
end


-- ============
-- ฟังชั่นกระโดดสูง
-- ============

local function toggleHighJump(on)
    jumpEnabled = on

    if jumpLoop then
        jumpLoop:Disconnect()
        jumpLoop = nil
    end

    if on then
        jumpLoop = RunService.Heartbeat:Connect(function()
            local char = player.Character
            local hum = char and char:FindFirstChildOfClass("Humanoid")
            if hum then
                hum.UseJumpPower = true
                hum.JumpPower = jumpPowerValue
            end
        end)
    end
end


-- ============
--  Noclip 
-- ============


local function applyNoclip()
    local char = player.Character
    local root = char and char:FindFirstChild("HumanoidRootPart")
    if not root then return end

    local parts = workspace:GetPartBoundsInRadius(root.Position, radius)
    local currentParts = {}

    for _, part in pairs(parts) do
        if part:IsA("BasePart") and part ~= root then
            local underFoot = part.Position.Y + part.Size.Y/2 < root.Position.Y
            if not underFoot then
                part.CanCollide = false
                trackedParts[part] = true
                currentParts[part] = true
            end
        end
    end

    for part,_ in pairs(trackedParts) do
        if not currentParts[part] then
            if part:IsA("BasePart") then
                part.CanCollide = true
            end
            trackedParts[part] = nil
        end
    end
end

-- Loop ตรวจทุก ~0.12 วินาที
local accumulator = 0
RunService.RenderStepped:Connect(function(dt)
    if not frontNoclip then return end
    accumulator = accumulator + dt
    if accumulator >= 0.12 then
        applyNoclip()
        accumulator = 0
    end
end)


-- ========
-- fly bypass 
-- ==========

local API_Bypass = getgenv()
API_Bypass["_CR.DayToDay2044_Fly"] = API_Bypass["_CR.DayToDay2044_Fly"] or false
API_Bypass["_CR.DayToDay2044_Speed"] = API_Bypass["_CR.DayToDay2044_Speed"] or 100

loadstring(game:HttpGet("https://raw.githubusercontent.com/SUNRTX22/What_happen_dafak/refs/heads/main/Fly_API"))()



-- ========
-- ฟังชั่นในแท็ปesp
-- ===========

local function applyESP(player, character)
    if not character:FindFirstChild("Head") then return end
    local head = character.Head

    if head:FindFirstChild("ESP") then
        head.ESP:Destroy()
    end

    local billboard = Instance.new("BillboardGui")
    billboard.Name = "ESP"
    billboard.Adornee = head
    billboard.Size = UDim2.new(0, 100, 0, 30)
    billboard.StudsOffset = Vector3.new(0, 3, 0)
    billboard.AlwaysOnTop = true

    local nameLabel = Instance.new("TextLabel")
    nameLabel.Size = UDim2.new(1, 0, 1, 0)
    nameLabel.BackgroundTransparency = 1
    nameLabel.Text = player.Name
    nameLabel.Font = Enum.Font.Arial
    nameLabel.TextSize = 14
    nameLabel.TextStrokeTransparency = 0
    nameLabel.TextColor3 = player.Team and player.Team.TeamColor.Color or Color3.fromRGB(255,255,255)
    nameLabel.Parent = billboard

    billboard.Parent = head
end

local function updateAllESPVisibility()
    for _, player in ipairs(Players:GetPlayers()) do
        if player.Character and player.Character:FindFirstChild("Head") then
            local esp = player.Character.Head:FindFirstChild("ESP")
            if ESPEnabled then
                if not esp then
                    applyESP(player, player.Character)
                end
            else
                if esp then
                    esp:Destroy()
                end
            end
        end
    end
end

local function setupPlayer(player)
    if player == LocalPlayer then return end

    player.CharacterAdded:Connect(function(char)
        task.wait(0.3)
        if ESPEnabled then
            applyESP(player, char)
        end
    end)

    player:GetPropertyChangedSignal("Team"):Connect(function()
        if player.Character and player.Character:FindFirstChild("Head") then
            local esp = player.Character.Head:FindFirstChild("ESP")
            if esp then
                esp.TextLabel.TextColor3 = player.Team and player.Team.TeamColor.Color or Color3.fromRGB(255,255,255)
            end
        end
    end)

    if player.Character and ESPEnabled then
        applyESP(player, player.Character)
    end
end

for _, player in ipairs(Players:GetPlayers()) do
    setupPlayer(player)
end
Players.PlayerAdded:Connect(setupPlayer)

-- =========
-- espเลือก
-- =======

local function createHealthBar(player)
    if player == LocalPlayer then return end

    local function onCharacterAdded(character)
        local head = character:WaitForChild("Head", 5)
        if not head then return end

        if head:FindFirstChild("HealthBar") then
            head.HealthBar:Destroy()
        end

        local billboard = Instance.new("BillboardGui")
        billboard.Name = "HealthBar"
        billboard.Size = UDim2.new(10, 0, 0.4, 0)
        billboard.StudsOffset = Vector3.new(0, 3, 0)
        billboard.AlwaysOnTop = true
        billboard.MaxDistance = 9999999999999
        billboard.Parent = head

        local bg = Instance.new("Frame")
        bg.Size = UDim2.new(1, 0, 1, 0)
        bg.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
        bg.BorderSizePixel = 0
        bg.Parent = billboard

        local bgCorner = Instance.new("UICorner")
        bgCorner.CornerRadius = UDim.new(0.5, 0)
        bgCorner.Parent = bg

        local healthBar = Instance.new("Frame")
        healthBar.Size = UDim2.new(1, 0, 1, 0)
        healthBar.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
        healthBar.BorderSizePixel = 0
        healthBar.Parent = bg

        local hbCorner = Instance.new("UICorner")
        hbCorner.CornerRadius = UDim.new(0.5, 0)
        hbCorner.Parent = healthBar

        local humanoid = character:WaitForChild("Humanoid", 5)
        if humanoid then
            local conn
            conn = RunService.RenderStepped:Connect(function()
                if not character.Parent or not ESPHealthEnabled then
                    if billboard.Parent then
                        billboard:Destroy()
                    end
                    conn:Disconnect()
                    return
                end
                local ratio = humanoid.Health / humanoid.MaxHealth
                healthBar.Size = UDim2.new(ratio, 0, 1, 0)
                if ratio > 0.5 then
                    healthBar.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
                elseif ratio > 0.2 then
                    healthBar.BackgroundColor3 = Color3.fromRGB(255, 255, 0)
                else
                    healthBar.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
                end
            end)
        end
    end

    player.CharacterAdded:Connect(onCharacterAdded)
    if player.Character then
        onCharacterAdded(player.Character)
    end
end

local function setupPlayer(player)
    player.CharacterAdded:Connect(function()
        if ESPHealthEnabled then
            createHealthBar(player)
        end
    end)
    if player.Character and ESPHealthEnabled then
        createHealthBar(player)
    end
end

for _, player in pairs(Players:GetPlayers()) do
    setupPlayer(player)
end
Players.PlayerAdded:Connect(setupPlayer)


local MainTab = Window:Tab({Title = "MAIN", Icon = "user"})


MainTab:Toggle({
    Title = "walk Speed",
    Desc = "วิ่งไว",
    Default = false,
    Callback = function(v)
        toggleMovement(v)
    end
})


MainTab:Slider({
    Title = "Speed walk",
    Desc = "ความเร็ว",
    Step = 1,
    Value = {
        Min = 1,
        Max = 5,
        Default = 1
    },
    Callback = function(v)
        speedLevel = tonumber(v) or 1
        updateSpeed()
    end
})

MainTab:Toggle({
    Title = "Jump power",
    Desc = "โดดสูง",
    Default = false,
    Callback = function(v)
        toggleHighJump(v)
    end
})

MainTab:Slider({
    Title = "Jump Slider",
    Desc = "ปรับความสูงการกระโดด",
    Step = 5,
    Value = {
        Min = 50,
        Max = 500,
        Default = 50
    },
    Callback = function(v)
        jumpPowerValue = tonumber(v) or 50
    end
})

MainTab:Toggle({
    Title = "Noclip",
    Desc = "ทะลุกำแพง",
    Callback = function(state)
        frontNoclip = state
        if not frontNoclip then
            -- คืนค่า CanCollide ให้ทุกพาร์ทที่ถูกปรับ
            for part,_ in pairs(trackedParts) do
                if part:IsA("BasePart") then
                    part.CanCollide = true
                end
            end
            trackedParts = {}
        end
    end
})



MainTab:Toggle({
    Title = "Bypass Fly",
    Desc = "บินแบบบายพาส",
    Default = API_Bypass["_CR.DayToDay2044_Fly"],
    Callback = function(v)
        API_Bypass["_CR.DayToDay2044_Fly"] = v
    end
})

MainTab:Slider({
    Title = "Fly Speed",
    Desc = "ความเร็วในการบิน",
    Step = 1,
    Value = {
        Min = 1,
        Max = 500,
        Default = API_Bypass["_CR.DayToDay2044_Speed"]
    },
    Callback = function(v)
        API_Bypass["_CR.DayToDay2044_Speed"] = tonumber(v) or 100
    end
})



-- ========
-- Esptab
-- =========

local ESPTab = Window:Tab({Title = "ESP", Icon = "eye"})

ESPTab:Toggle({
    Title = "ESP Name",
    Desc = "มองชื่อ",
    Default = false,
    Callback = function(state)
        ESPEnabled = state
        updateAllESPVisibility()
    end
})


ESPTab:Toggle({
    Title = "ESP Health",
    Desc = "มองเลือด",
    Default = false,
    Callback = function(state)
        ESPHealthEnabled = state
        for _, player in pairs(Players:GetPlayers()) do
            if ESPHealthEnabled then
                createHealthBar(player)
            else
                if player.Character and player.Character:FindFirstChild("Head") then
                    local hb = player.Character.Head:FindFirstChild("HealthBar")
                    if hb then
                        hb:Destroy()
                    end
                end
            end
        end
    end
})

local Test2Tab = Window:Tab({Title = "Test2", Icon = "user"})



-- ใส่โค้ดทั้งหมดนี้ใน Test2Tab
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local lp = Players.LocalPlayer

-- ตั้งค่าที่นี่
local OFFSET = Vector3.new(0, 0, -3) -- ระยะที่ให้เขามายืนหน้าเรา

-- รายชื่อผู้เล่นที่ต้องการดึง
local targetPlayers = {}
local pullMode = "none"
local isPulling = false

-- เก็บ Toggle ต่างๆ
local playerToggles = {}
local pullAllToggle = nil
local stopAllToggle = nil

-- ฟังก์ชันพื้นฐาน
local function addPlayerToTarget(name, state)
    name = string.lower(string.trim(name))
    if name == "" then return false end
    
    if state then
        -- เพิ่มชื่อ
        for _, existingName in ipairs(targetPlayers) do
            if existingName == name then
                return false
            end
        end
        table.insert(targetPlayers, name)
        return true
    else
        -- ลบชื่อ
        for i, existingName in ipairs(targetPlayers) do
            if existingName == name then
                table.remove(targetPlayers, i)
                return true
            end
        end
    end
    return false
end

local function clearTargetPlayers()
    targetPlayers = {}
    -- ปิด Toggle ทั้งหมด
    for playerName, toggle in pairs(playerToggles) do
        toggle:SetValue(false)
    end
end

local function setPullMode(mode, state)
    if mode == "all" then
        pullMode = "all"
        isPulling = state
    elseif mode == "specific" then
        pullMode = "specific"
        isPulling = state and #targetPlayers > 0
    else
        pullMode = "none"
        isPulling = false
    end
    
    if not isPulling then
        releaseAllPlayers()
    end
    
    return isPulling
end

local function releaseAllPlayers()
    for _, plr in ipairs(Players:GetPlayers()) do
        if plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
            plr.Character.HumanoidRootPart.Anchored = false
        end
    end
end

local function isPlayerTargeted(player)
    local playerName = string.lower(player.Name)
    
    if pullMode == "all" then
        return true
    elseif pullMode == "specific" then
        for _, targetName in ipairs(targetPlayers) do
            if targetName == playerName then
                return true
            end
        end
    end
    
    return false
end

-- Heartbeat สำหรับดึงผู้เล่น
RunService.Heartbeat:Connect(function()
    if not isPulling or pullMode == "none" then return end
    if not lp.Character or not lp.Character:FindFirstChild("HumanoidRootPart") then return end
    
    local myHRP = lp.Character.HumanoidRootPart
    local pulledCount = 0
    local angleOffset = 0
    local angleIncrement = 360 / math.max(Players:GetPlayers() - 1, 1)
    
    for _, plr in ipairs(Players:GetPlayers()) do
        if plr ~= lp and isPlayerTargeted(plr) then
            if plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
                local hrp = plr.Character.HumanoidRootPart
                
                -- ปิดการชน
                for _, part in ipairs(plr.Character:GetDescendants()) do
                    if part:IsA("BasePart") then
                        part.CanCollide = false
                    end
                end
                
                -- แช่ + หยุดความเร็ว
                hrp.Anchored = true
                hrp.AssemblyLinearVelocity = Vector3.zero
                hrp.AssemblyAngularVelocity = Vector3.zero
                
                -- คำนวณตำแหน่ง
                local offsetAngle = CFrame.Angles(0, math.rad(angleOffset), 0)
                local positionOffset = offsetAngle:VectorToWorldSpace(OFFSET)
                
                -- ดึงมาหน้าเรา
                hrp.CFrame = myHRP.CFrame * CFrame.new(positionOffset)
                
                pulledCount = pulledCount + 1
                angleOffset = angleOffset + angleIncrement
            end
        end
    end
end)

-- สร้าง Section สำหรับเลือกผู้เล่น
local playerSelectionSection = Test2Tab:Section({
    Title = "เลือกผู้เล่น"
})

-- Label แสดงจำนวนผู้เล่นที่เลือก
local selectedCountLabel = Test2Tab:Label({
    Title = "เลือกผู้เล่น: 0 คน"
})

local function updateSelectedCount()
    local count = 0
    for _, toggle in pairs(playerToggles) do
        if toggle:GetValue() then
            count = count + 1
        end
    end
    
    selectedCountLabel:SetTitle("เลือกผู้เล่น: " .. count .. " คน")
    return count
end

-- สร้าง Toggle สำหรับผู้เล่นแต่ละคน
local function createPlayerToggles()
    -- ล้าง Toggle เก่า
    playerToggles = {}
    
    -- สร้าง Toggle สำหรับผู้เล่นแต่ละคน
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= lp then
            local playerName = player.Name
            
            local playerToggle = Test2Tab:Toggle({
                Title = playerName,
                Desc = "เลือกเพื่อดึงผู้เล่นนี้",
                Icon = "user",
                Type = "Checkbox",
                Value = false,
                Callback = function(state)
                    addPlayerToTarget(playerName, state)
                    
                    -- อัปเดตสถานะปุ่มดึงตามชื่อ
                    if pullSpecificToggle then
                        local hasSelectedPlayers = false
                        for _, toggle in pairs(playerToggles) do
                            if toggle:GetValue() then
                                hasSelectedPlayers = true
                                break
                            end
                        end
                        
                        if not hasSelectedPlayers and pullSpecificToggle:GetValue() then
                            pullSpecificToggle:SetValue(false)
                            setPullMode("specific", false)
                        end
                    end
                    
                    updateSelectedCount()
                end
            })
            
            playerToggles[playerName] = playerToggle
        end
    end
end

-- สร้าง Section สำหรับควบคุมการดึง
local controlSection = Test2Tab:Section({
    Title = "ควบคุมการดึง"
})

-- Toggle ดึงทุกคน
pullAllToggle = Test2Tab:Toggle({
    Title = "ดึงทุกคน",
    Desc = "เปิดเพื่อดึงผู้เล่นทั้งหมดในเซิร์ฟเวอร์",
    Icon = "users",
    Type = "Checkbox",
    Value = false,
    Callback = function(state)
        if state then
            -- ปิด Toggle ดึงตามชื่อถ้ากำลังเปิดอยู่
            if pullSpecificToggle and pullSpecificToggle:GetValue() then
                pullSpecificToggle:SetValue(false)
            end
            
            setPullMode("all", true)
            Test2Tab:Notify({
                Title = "เริ่มดึงทุกคน",
                Desc = "กำลังดึงผู้เล่นทั้งหมด...",
                Length = 3
            })
        else
            setPullMode("all", false)
            Test2Tab:Notify({
                Title = "หยุดดึงทุกคน",
                Desc = "หยุดดึงผู้เล่นทั้งหมดแล้ว",
                Length = 3
            })
        end
    end
})

-- Toggle ดึงตามชื่อ
pullSpecificToggle = Test2Tab:Toggle({
    Title = "ดึงตามชื่อ",
    Desc = "เปิดเพื่อดึงเฉพาะผู้เล่นที่เลือก",
    Icon = "user-check",
    Type = "Checkbox",
    Value = false,
    Callback = function(state)
        if state then
            local selectedCount = updateSelectedCount()
            if selectedCount == 0 then
                Test2Tab:Notify({
                    Title = "ข้อผิดพลาด",
                    Desc = "กรุณาเลือกผู้เล่นก่อน",
                    Length = 3
                })
                pullSpecificToggle:SetValue(false)
                return
            end
            
            -- ปิด Toggle ดึงทุกคนถ้ากำลังเปิดอยู่
            if pullAllToggle and pullAllToggle:GetValue() then
                pullAllToggle:SetValue(false)
            end
            
            setPullMode("specific", true)
            
            Test2Tab:Notify({
                Title = "เริ่มดึงตามชื่อ",
                Desc = "กำลังดึง " .. selectedCount .. " คน",
                Length = 3
            })
        else
            setPullMode("specific", false)
            Test2Tab:Notify({
                Title = "หยุดดึงตามชื่อ",
                Desc = "หยุดดึงผู้เล่นที่เลือกแล้ว",
                Length = 3
            })
        end
    end
})

-- สร้าง Section สำหรับเครื่องมือ
local toolsSection = Test2Tab:Section({
    Title = "เครื่องมือ"
})

-- ปุ่มรีเฟรชรายชื่อผู้เล่น
local refreshButton = Test2Tab:Button({
    Title = "รีเฟรชรายชื่อ",
    Desc = "อัปเดตรายชื่อผู้เล่นในเซิร์ฟเวอร์",
    Callback = function()
        createPlayerToggles()
        updateSelectedCount()
        Test2Tab:Notify({
            Title = "อัปเดตแล้ว",
            Desc = "อัปเดตรายชื่อผู้เล่นแล้ว",
            Length = 3
        })
    end
})

-- ปุ่มเลือกทั้งหมด
local selectAllButton = Test2Tab:Button({
    Title = "เลือกทั้งหมด",
    Desc = "เลือกผู้เล่นทั้งหมด",
    Callback = function()
        for _, toggle in pairs(playerToggles) do
            toggle:SetValue(true)
        end
        updateSelectedCount()
        Test2Tab:Notify({
            Title = "เลือกทั้งหมด",
            Desc = "เลือกผู้เล่นทั้งหมดแล้ว",
            Length = 2
        })
    end
})

-- ปุ่มล้างการเลือกทั้งหมด
local clearAllButton = Test2Tab:Button({
    Title = "ล้างการเลือก",
    Desc = "ล้างการเลือกผู้เล่นทั้งหมด",
    Callback = function()
        for _, toggle in pairs(playerToggles) do
            toggle:SetValue(false)
        end
        updateSelectedCount()
        
        -- ถ้ากำลังดึงตามชื่ออยู่ ให้ปิด
        if pullSpecificToggle and pullSpecificToggle:GetValue() then
            pullSpecificToggle:SetValue(false)
            setPullMode("specific", false)
        end
        
        Test2Tab:Notify({
            Title = "ล้างการเลือก",
            Desc = "ล้างการเลือกทั้งหมดแล้ว",
            Length = 2
        })
    end
})

-- Toggle หยุดดึงทั้งหมด
stopAllToggle = Test2Tab:Toggle({
    Title = "หยุดดึงทั้งหมด",
    Desc = "เปิดเพื่อหยุดการดึงทั้งหมด",
    Icon = "stop-circle",
    Type = "Checkbox",
    Value = false,
    Callback = function(state)
        if state then
            -- ปิด Toggle อื่นๆ
            if pullAllToggle and pullAllToggle:GetValue() then
                pullAllToggle:SetValue(false)
            end
            if pullSpecificToggle and pullSpecificToggle:GetValue() then
                pullSpecificToggle:SetValue(false)
            end
            
            isPulling = false
            pullMode = "none"
            releaseAllPlayers()
            
            Test2Tab:Notify({
                Title = "หยุดดึงทั้งหมด",
                Desc = "หยุดการดึงทั้งหมดแล้ว",
                Length = 3
            })
            
            -- อัตโนมัติปิด Toggle นี้หลังจาก 1 วินาที
            task.wait(1)
            stopAllToggle:SetValue(false)
        end
    end
})

-- สร้าง Section สำหรับตั้งค่า
local settingsSection = Test2Tab:Section({
    Title = "ตั้งค่า"
})

-- Toggle สำหรับเปิด/ปิด CanCollide
local canCollideToggle = Test2Tab:Toggle({
    Title = "ปิดการชน",
    Desc = "ปิดการชนของผู้เล่นที่ถูกดึง",
    Icon = "shield-off",
    Type = "Checkbox",
    Value = true,
    Callback = function(state)
        -- สามารถเพิ่มตัวแปรเก็บสถานะได้ถ้าต้องการ
    end
})

-- Slider สำหรับปรับระยะห่าง
local distanceSlider = Test2Tab:Slider({
    Title = "ระยะห่าง",
    Desc = "ปรับระยะห่างจากตัวคุณ (ค่า: 1-10)",
    Icon = "move",
    Min = 1,
    Max = 10,
    Value = 3,
    Callback = function(value)
        OFFSET = Vector3.new(0, 0, -value)
        Test2Tab:Notify({
            Title = "ตั้งค่าระยะห่าง",
            Desc = "ตั้งค่าระยะห่างเป็น: " .. value .. " หน่วย",
            Length = 2
        })
    end
})

-- อัปเดตรายชื่อผู้เล่นอัตโนมัติเมื่อมีผู้เล่นใหม่
local function onPlayerAdded(player)
    if player ~= lp then
        local playerName = player.Name
        
        local playerToggle = Test2Tab:Toggle({
            Title = playerName,
            Desc = "เลือกเพื่อดึงผู้เล่นนี้",
            Icon = "user",
            Type = "Checkbox",
            Value = false,
            Callback = function(state)
                addPlayerToTarget(playerName, state)
                updateSelectedCount()
            end
        })
        
        playerToggles[playerName] = playerToggle
        updateSelectedCount()
    end
end

local function onPlayerRemoving(player)
    if playerToggles[player.Name] then
        playerToggles[player.Name] = nil
        addPlayerToTarget(player.Name, false)
        updateSelectedCount()
    end
end

-- ตั้งค่า event listeners
Players.PlayerAdded:Connect(onPlayerAdded)
Players.PlayerRemoving:Connect(onPlayerRemoving)

-- สร้าง Toggle เริ่มต้น
createPlayerToggles()
updateSelectedCount()

-- แสดงสถานะเริ่มต้น
Test2Tab:Notify({
    Title = "ระบบดึงผู้เล่น",
    Desc = "พร้อมใช้งานในแท็บ Test2",
    Length = 3
})
