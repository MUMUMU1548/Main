-- Services
local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer
local LocalPlayer = game:GetService("Players").LocalPlayer

local WindUI = loadstring(game:HttpGet(
    "https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"
))()

local Window = WindUI:CreateWindow({
    Title = "ERROR HUB [ ALL Map ]",
    Icon = "rbxassetid://108455308252343", 
    Author = "",
    Folder = "ERROR HUB [ ALL Map ]",
    Size = UDim2.fromOffset(450, 330),
    Theme = "Violet", 
    Transparent = true,
    Resizable = true,
})

Window:EditOpenButton({ Enabled = false }) 

local ScreenGui = Instance.new("ScreenGui")
local ToggleBtn = Instance.new("ImageButton")
local UICorner = Instance.new("UICorner") 

ScreenGui.Name = "ERROR HUB"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = CoreGui

ToggleBtn.Size = UDim2.new(0, 50, 0, 50)
ToggleBtn.Position = UDim2.new(0, 20, 0.5, -25)
ToggleBtn.BackgroundColor3 = Color3.fromRGB(138, 43, 226)
ToggleBtn.BackgroundTransparency = 0
ToggleBtn.Image = "rbxassetid://108455308252343"
ToggleBtn.Active = true
ToggleBtn.Draggable = true
ToggleBtn.Parent = ScreenGui

UICorner.CornerRadius = UDim.new(0, 12) 
UICorner.Parent = ToggleBtn

local opened = true

local function toggle()
    opened = not opened
    if Window.UI then
        Window.UI.Enabled = opened
    else
        Window:Toggle()
    end
end

ToggleBtn.MouseButton1Click:Connect(function()
    ToggleBtn:TweenSize(
        UDim2.new(0, 56, 0, 56),
        Enum.EasingDirection.Out,
        Enum.EasingStyle.Quad,
        0.12,
        true,
        function()
            ToggleBtn:TweenSize(
                UDim2.new(0, 50, 0, 50),
                Enum.EasingDirection.Out,
                Enum.EasingStyle.Quad,
                0.12,
                true
            )
        end
    )
    toggle()
end)

UserInputService.InputBegan:Connect(function(input, gp)
    if gp then return end
    if input.KeyCode == Enum.KeyCode.T then
        toggle()
    end
end)



-- ตัวแปร
local enabled = false
local speedLevel = 1
local speedValue = 60
local loopConnection = nil

local jumpEnabled = false
local jumpPowerValue = 50
local jumpLoop = nil

local frontNoclip = false
local frontLoop

local nameESP = false
local hpESP = false
local distESP = false
local boxESP = false
local Boxes = {}
local MAX_DISTANCE = 1500
local MIN_SIZE = 18

local function updateSpeed()
    speedValue = speedLevel * 60
end
updateSpeed()

local function toggleMovement(on)
    enabled = on

    if loopConnection then
        loopConnection:Disconnect()
        loopConnection = nil
    end

    if on then
        loopConnection = RunService.Heartbeat:Connect(function(dt)
            local char = player.Character
            local root = char and char:FindFirstChild("HumanoidRootPart")
            local hum = char and char:FindFirstChildOfClass("Humanoid")
            if not (char and root and hum) then return end

            local moveDir = hum.MoveDirection
            if moveDir.Magnitude > 0 then
                root.CFrame = root.CFrame + moveDir * (speedValue * dt)
            end
        end)
    end
end


-- ============
-- ฟังชั่นกระโดดสูง
-- ============

local function toggleHighJump(on)
    jumpEnabled = on

    if jumpLoop then
        jumpLoop:Disconnect()
        jumpLoop = nil
    end

    if on then
        jumpLoop = RunService.Heartbeat:Connect(function()
            local char = player.Character
            local hum = char and char:FindFirstChildOfClass("Humanoid")
            if hum then
                hum.UseJumpPower = true
                hum.JumpPower = jumpPowerValue
            end
        end)
    end
end


-- ============
--  Noclip 
-- ============

local function toggleFrontUnCanCollide(on)
    frontNoclip = on

    if frontLoop then
        frontLoop:Disconnect()
        frontLoop = nil
    end

    if on then
        frontLoop = RunService.RenderStepped:Connect(function()
            local char = player.Character
            local root = char and char:FindFirstChild("HumanoidRootPart")
            if not root then return end

            -- ยิง Ray ไปข้างหน้า
            local rayParams = RaycastParams.new()
            rayParams.FilterDescendantsInstances = {char}
            rayParams.FilterType = Enum.RaycastFilterType.Blacklist

            local result = workspace:Raycast(
                root.Position,
                root.CFrame.LookVector * 4,
                rayParams
            )

            if result and result.Instance and result.Instance:IsA("BasePart") then
                result.Instance.CanCollide = false
            end
        end)
    end
end


-- ========
-- fly bypass 
-- ==========

local API_Bypass = getgenv()
API_Bypass["_CR.DayToDay2044_Fly"] = API_Bypass["_CR.DayToDay2044_Fly"] or false
API_Bypass["_CR.DayToDay2044_Speed"] = API_Bypass["_CR.DayToDay2044_Speed"] or 100

loadstring(game:HttpGet("https://raw.githubusercontent.com/SUNRTX22/What_happen_dafak/refs/heads/main/Fly_API"))()



-- ========
-- ฟังชั่นในแท็ปesp
-- ===========

local function teamColor(plr)
    if plr.Team then return plr.TeamColor.Color end
    return Color3.new(1,1,1)
end

local function hpColor(hp, max)
    local p = math.clamp(hp/max,0,1)
    return Color3.fromRGB(255*(1-p),255*p,0)
end

function attachBillboard(plr)
    if plr == LocalPlayer then return end

    local char = plr.Character
    if not char then return end

    local root = char:FindFirstChild("HumanoidRootPart")
    local hum = char:FindFirstChildOfClass("Humanoid")
    if not root or not hum then return end

    if root:FindFirstChild("ESP_UI") then
        root.ESP_UI:Destroy()
    end

    local gui = Instance.new("BillboardGui", root)
    gui.Name = "ESP_UI"
    gui.Size = UDim2.new(0,140,0,54)
    gui.StudsOffset = Vector3.new(0,2.6,0)
    gui.AlwaysOnTop = true

    local layout = Instance.new("UIListLayout", gui)
    layout.Padding = UDim.new(0,2)

    local name = Instance.new("TextLabel", gui)
    name.Size = UDim2.new(1,0,0,18)
    name.BackgroundTransparency = 1
    name.TextScaled = true
    name.Font = Enum.Font.GothamBold
    name.TextStrokeTransparency = 0.3

    local hp = Instance.new("TextLabel", gui)
    hp.Size = UDim2.new(1,0,0,16)
    hp.BackgroundTransparency = 1
    hp.TextScaled = true
    hp.Font = Enum.Font.Gotham
    hp.TextStrokeTransparency = 0.4

    local dist = Instance.new("TextLabel", gui)
    dist.Size = UDim2.new(1,0,0,16)
    dist.BackgroundTransparency = 1
    dist.TextScaled = true
    dist.Font = Enum.Font.Gotham
    dist.TextStrokeTransparency = 0.4
    dist.TextColor3 = Color3.fromRGB(200,200,200)

    RunService.Heartbeat:Connect(function()
        if not gui.Parent then return end

        name.Visible = nameESP
        hp.Visible = hpESP
        dist.Visible = distESP

        if nameESP then
            name.Text = plr.Name
            name.TextColor3 = teamColor(plr)
        end

        if hpESP then
            local h = math.floor(hum.Health)
            local m = math.max(1, hum.MaxHealth)
            hp.Text = "[ "..h.." ]"
            hp.TextColor3 = hpColor(h,m)
        end

        if distESP then
            local myRoot = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
            if myRoot then
                local d = math.floor((myRoot.Position-root.Position).Magnitude)
                dist.Text = "[ "..d.."m ]"
            end
        end
    end)
end

for _,p in pairs(Players:GetPlayers()) do
    if p ~= LocalPlayer then
        p.CharacterAdded:Connect(function() attachBillboard(p) end)
        if p.Character then attachBillboard(p) end
    end
end
Players.PlayerAdded:Connect(function(p)
    if p ~= LocalPlayer then
        p.CharacterAdded:Connect(function() attachBillboard(p) end)
    end
end)

-- corner



local function NewLine()
    local l = Drawing.new("Line")
    l.Thickness = 2
    l.Transparency = 1
    return l
end

local function CreateBox(plr)
    local t = {}
    for i=1,8 do t[i] = NewLine() end
    Boxes[plr] = t
end

local function RemoveBox(plr)
    if Boxes[plr] then
        for _,v in pairs(Boxes[plr]) do v:Remove() end
        Boxes[plr] = nil
    end
end

for _,v in pairs(Players:GetPlayers()) do if v ~= LocalPlayer then CreateBox(v) end end
Players.PlayerAdded:Connect(function(p) if p ~= LocalPlayer then CreateBox(p) end end)
Players.PlayerRemoving:Connect(RemoveBox)

RunService.RenderStepped:Connect(function()
    for plr,lines in pairs(Boxes) do
        for _,v in pairs(lines) do v.Visible=false end
        if not boxESP then continue end

        local char = plr.Character
        local hrp = char and char:FindFirstChild("HumanoidRootPart")
        local hum = char and char:FindFirstChildOfClass("Humanoid")
        if hrp and hum and hum.Health > 0 then
            local pos, onscreen = Camera:WorldToViewportPoint(hrp.Position)
            if onscreen then
                local scale = math.clamp(1/(pos.Z/35),0.4,5)
                local w = math.max(40*scale, MIN_SIZE)
                local h = math.max(60*scale, MIN_SIZE*1.5)
                local x,y = pos.X - w/2, pos.Y - h/2
                local c = teamColor(plr)
                local corner = math.max(10*scale,6)

                local function L(i,x1,y1,x2,y2)
                    local ln = lines[i]
                    ln.From = Vector2.new(x1,y1)
                    ln.To = Vector2.new(x2,y2)
                    ln.Color = c
                    ln.Visible = true
                end

                L(1,x,y,x+corner,y)
                L(2,x,y,x,y+corner)
                L(3,x+w,y,x+w-corner,y)
                L(4,x+w,y,x+w,y+corner)
                L(5,x,y+h,x+corner,y+h)
                L(6,x,y+h,x,y+h-corner)
                L(7,x+w,y+h,x+w-corner,y+h)
                L(8,x+w,y+h,x+w,y+h-corner)
            end
        end
    end
end)


local MainTab = Window:Tab({Title = "MAIN", Icon = "user"})


MainTab:Toggle({
    Title = "walk Speed",
    Desc = "วิ่งไว",
    Default = false,
    Callback = function(v)
        toggleMovement(v)
    end
})


MainTab:Slider({
    Title = "Speed walk",
    Desc = "ความเร็ว",
    Step = 1,
    Value = {
        Min = 1,
        Max = 5,
        Default = 1
    },
    Callback = function(v)
        speedLevel = tonumber(v) or 1
        updateSpeed()
    end
})

MainTab:Toggle({
    Title = "Jump power",
    Desc = "โดดสูง",
    Default = false,
    Callback = function(v)
        toggleHighJump(v)
    end
})

MainTab:Slider({
    Title = "Jump Slider",
    Desc = "ปรับความสูงการกระโดด",
    Step = 5,
    Value = {
        Min = 50,
        Max = 500,
        Default = 50
    },
    Callback = function(v)
        jumpPowerValue = tonumber(v) or 50
    end
})

MainTab:Toggle({
    Title = "Noclip",
    Desc = "ทะลุกำแพง",
    Default = false,
    Callback = function(v)
        toggleFrontUnCanCollide(v)
    end
})


MainTab:Toggle({
    Title = "Bypass Fly",
    Desc = "บินแบบบายพาส",
    Default = API_Bypass["_CR.DayToDay2044_Fly"],
    Callback = function(v)
        API_Bypass["_CR.DayToDay2044_Fly"] = v
    end
})

MainTab:Slider({
    Title = "Fly Speed",
    Desc = "ความเร็วในการบิน",
    Step = 1,
    Value = {
        Min = 1,
        Max = 500,
        Default = API_Bypass["_CR.DayToDay2044_Speed"]
    },
    Callback = function(v)
        API_Bypass["_CR.DayToDay2044_Speed"] = tonumber(v) or 100
    end
})



-- ========
-- Esptab
-- =========

local ESPTab = Window:Tab({Title = "ESP", Icon = "eye"})

ESPTab:Toggle({
    Title="Name ESP",
    Callback=function(v)
        nameESP = v
        refreshAll()
    end
})

ESPTab:Toggle({
    Title="HP ESP",
    Callback=function(v)
        hpESP = v
        refreshAll()
    end
})

ESPTab:Toggle({
    Title="Distance ESP",
    Callback=function(v)
        distESP = v
        refreshAll()
    end
})

ESPTab:Toggle({
    Title="Box ESP",
    Callback=function(v)
        boxESP = v
    end
})

